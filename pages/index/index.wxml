<!--pages/index/index.wxml-->
<view class="container">
  <!-- å¤´éƒ¨åŒºåŸŸ -->
  <view class="header">
    <view class="title">ç®€çº¦ä»»åŠ¡</view>
    <view class="subtitle">{{tasks.length}} ä¸ªä»»åŠ¡</view>
  </view>

  <!-- æ’åºå’Œç­›é€‰æ  -->
  <view class="filter-bar">
    <picker bindchange="onSortChange" value="{{sortIndex}}" range="{{sortOptions}}">
      <view class="sort-picker">
        <text>{{sortOptions[sortIndex]}}</text>
        <text class="arrow">â–¼</text>
      </view>
    </picker>

    <view class="filter-buttons">
      <view class="filter-btn {{showCompleted ? '' : 'active'}}" bindtap="toggleShowCompleted">
        è¿›è¡Œä¸­
      </view>
      <view class="filter-btn {{showCompleted ? 'active' : ''}}" bindtap="toggleShowCompleted">
        å·²å®Œæˆ
      </view>
    </view>
  </view>

  <!-- æœç´¢æ¡† -->
  <view class="search-container">
    <input class="search-input"
           placeholder="æœç´¢ä»»åŠ¡..."
           value="{{searchKeyword}}"
           bindinput="onSearchInput"
           confirm-type="search" />
  </view>

  <!-- ä»»åŠ¡åˆ—è¡¨ -->
  <view class="task-list">
    <view wx:if="{{filteredTasks.length === 0}}" class="empty-state">
      <view class="empty-icon">ğŸ“</view>
      <view class="empty-text">{{emptyText}}</view>
    </view>

    <view wx:else>
      <view wx:for="{{filteredTasks}}"
            wx:key="id"
            class="task-item {{item.completed ? 'completed' : ''}}"
            bindtap="onTaskTap"
            data-id="{{item.id}}">

        <!-- ä»»åŠ¡ä¸»è¦å†…å®¹ -->
        <view class="task-content">
          <view class="task-header">
            <checkbox class="task-checkbox"
                     checked="{{item.completed}}"
                     bindtap="onToggleComplete"
                     data-id="{{item.id}}" />
            <view class="task-title {{item.completed ? 'completed-text' : ''}}">
              {{item.title}}
            </view>
            <view class="priority-badge priority-{{item.priority}}">
              {{priorityLabels[item.priority]}}
            </view>
          </view>

          <view wx:if="{{item.description}}" class="task-description">
            {{item.description}}
          </view>

          <view class="task-meta">
            <view wx:if="{{item.dueDate}}" class="due-date {{isOverdue(item.dueDate) && !item.completed ? 'overdue' : ''}}">
              ğŸ“… {{formatDate(item.dueDate)}}
            </view>
            <view class="created-date">
              åˆ›å»ºäº {{formatCreatedDate(item.createdAt)}}
            </view>
          </view>
        </view>

        <!-- æ“ä½œæŒ‰é’® -->
        <view class="task-actions">
          <view class="action-btn edit-btn"
                bindtap="onEditTask"
                data-id="{{item.id}}">
            âœï¸
          </view>
          <view class="action-btn delete-btn"
                bindtap="onDeleteTask"
                data-id="{{item.id}}">
            ğŸ—‘ï¸
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ·»åŠ æŒ‰é’® -->
  <view class="fab" bindtap="onAddTask">
    <text class="fab-icon">+</text>
  </view>
</view>